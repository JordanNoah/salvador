{"version":3,"file":"provider.min.js","sources":["../../src/cases/provider.js"],"sourcesContent":["import Templates from 'core/templates';\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport {exception as displayException} from 'core/notification';\n\n// eslint-disable-next-line no-unused-vars\nlet pages = 0;\nlet filters = [];\n// eslint-disable-next-line no-unused-vars\nlet selectedPage = 1;\n\nexport const init = () => {\n    getCases();\n    $('.dropdown-menu').on('click', function(e) {\n        e.stopPropagation();\n    });\n    getAndRenderFilters();\n    setActionsFilters();\n};\n\nconst getAndRenderFilters = async () => {\n    const themesRequest = {methodname: 'local_digitalta_themes_get', args: {}};\n    const tagsRequest = {methodname: 'local_digitalta_tags_get', args: {}};\n    const languajesRequest = {methodname: 'local_digitalta_experiences_get_used_langs', args: {}};\n\n    const themesResponse = await Ajax.call([themesRequest])[0];\n    const tagsResponse = await Ajax.call([tagsRequest])[0];\n    const languajesResponse = await Ajax.call([languajesRequest])[0];\n\n    // eslint-disable-next-line max-len\n    const templateFilterThemes = await Templates.renderForPromise('local_digitalta/_common/filterTheme', {\"themes\": themesResponse});\n    // eslint-disable-next-line max-len\n    const templateFilterLanguajes = await Templates.renderForPromise('local_digitalta/_common/filterLanguajes', {\"languajes\": languajesResponse});\n    Templates.replaceNodeContents(\"#filterThemeSelect\", templateFilterThemes.html, templateFilterThemes.js);\n    Templates.replaceNodeContents(\"#filterLanguajeSelect\", templateFilterLanguajes.html, templateFilterLanguajes.js);\n\n    const availableTags = tagsResponse.map(function(tag) {\n        return tag.name;\n    });\n\n    $('#inlineFormInputGroup').on('input', async function() {\n        var input = $(this).val().toLowerCase();\n        var suggestions = availableTags.filter(function(tag) {\n            return tag.toLowerCase().startsWith(input);\n        });\n\n        const templateFilterTags = await Templates.renderForPromise('local_digitalta/_common/listTags', {tags: suggestions});\n        Templates.replaceNodeContents(\"#suggestionsTags\", templateFilterTags.html, templateFilterTags.js);\n    });\n};\n\nconst setActionsFilters = () => {\n    $(document).on(\"click\", \"li.page-item.page-link.page\", function() {\n        const clickedPage = $(this).attr('attr-page');\n        if (selectedPage !== clickedPage) {\n            selectedPage = parseInt(clickedPage);\n            getCases();\n        }\n    });\n    $(document).on(\"click\", \"li.page-item.page-link.state\", function() {\n        const state = $(this).attr('aria-label');\n        if (state === 'Next') {\n            const posibleNextPage = selectedPage + 1;\n            if (posibleNextPage > 0 && posibleNextPage <= pages) {\n                selectedPage++;\n                getCases();\n            }\n        } else if (state === 'Previous') {\n            const posiblePreviousPage = selectedPage - 1;\n            if (posiblePreviousPage > 0 && posiblePreviousPage <= pages) {\n                selectedPage--;\n                getCases();\n            }\n        }\n    });\n    $(document).on(\"change\", \".filterThemeSelect\", function() {\n        const selectedText = $(\"option:selected.enable\", this).text();\n        if (selectedText.length > 0) {\n            const element = $(\"option:selected.enable\", this);\n            element.addClass('disabled');\n            element.removeClass('enable');\n            const filterObject = {\"type\": \"theme\", \"value\": selectedText};\n            setFilter(filterObject);\n        }\n    });\n\n    $(\"#suggestionsTags\").on(\"click\", \".tag-item\", function() {\n        const filterText = {type: \"tag\", value: $(this).attr('attr-name')};\n        setFilter(filterText);\n        $(\"#inlineFormInputGroup\").val(\"\");\n    });\n\n    $(document).on(\"keydown\", \"#autorFilters\", async function() {\n        const filterText = $(this).val(); // Obtenemos el valor del input\n        const request = {\n            methodname: 'core_enrol_get_potential_users',\n            args: {courseid: 1, enrolid: 1, page: 0, perpage: 10, search: filterText, searchanywhere: true}\n        };\n        const response = await Ajax.call([request])[0];\n\n        if (response.length === 0) {\n            $(\"#suggestionsAutors\").empty();\n        }else{\n            const authorsSuggestions = await Templates.renderForPromise('local_digitalta/_common/listAutors', {users: response});\n            Templates.replaceNodeContents(\"#suggestionsAutors\", authorsSuggestions.html, authorsSuggestions.js);\n        }\n    });\n\n    $(\"#suggestionsAutors\").on(\"click\", \".autor-item\", function() {\n        const filterText = {type: \"author\", value: {id: $(this).attr('attr-id-user'), name: $(this).attr('attr-name')}};\n        setFilter(filterText);\n        $(\"#autorFilters\").val(\"\");\n    });\n\n    $(document).on(\"change\", \".filterLanguajeSelect\", function() {\n        const selectedText = $(\"option:selected.enable\", this).text();\n        if (selectedText.length > 0) {\n            const element = $(\"option:selected.enable\", this);\n            element.addClass('disabled');\n            element.removeClass('enable');\n            const filterObject = {\"type\": \"languaje\", \"value\": selectedText};\n            setFilter(filterObject);\n        }\n    });\n\n    $(\"#filters-menu\").click(function() {\n        if ($(\".tagsInputFilter\").is(\":focus\")) {\n            $(\"#suggestionsAutors\").hide();\n            $(\"#suggestionsTags\").show();\n        } else if ($(\"#autorFilters\").is(\":focus\")) {\n            $(\"#suggestionsTags\").hide();\n            $(\"#suggestionsAutors\").show();\n        } else {\n            $(\"#suggestionsTags\").hide();\n            $(\"#suggestionsAutors\").hide();\n        }\n    });\n\n    $(document).on(\"click\", \"#removeFilter\", function() {\n        const filterText = $(this).attr('attr-filter');\n        const filterType = $(this).attr('attr-type');\n        const filterObject = {\"type\": filterType, \"value\": filterText};\n        removeFilter(filterObject);\n    });\n};\n\n\nconst removeFilter = (filterObject) => {\n    const index = filters.findIndex((filter) => {\n        if (filter.type === 'author') {\n            return filter.type === filterObject.type && filter.value.name === filterObject.value;\n        } else {\n            return filter.type === filterObject.type && filter.value === filterObject.value;\n        }\n    });\n\n    if (index > -1) {\n        if (filterObject.type === 'theme') {\n            let themeSelect = $(\"#filterThemes\");\n            let option = $('option[value=\"'+filterObject.value+'\"].disabled', themeSelect);\n            option.removeClass('disabled');\n            option.addClass('enable');\n        } else if (filterObject.type === 'languaje') {\n            let langSelect = $(\".filterLanguajeSelect\");\n            let option = $('option[value=\"'+filterObject.value+'\"].disabled', langSelect);\n            option.removeClass('disabled');\n            option.addClass('enable');\n        }\n        filters.splice(index, 1);\n        selectedPage = 1;\n        renderFilters();\n    }\n};\n\nconst setFilter = (filterObject) => {\n    filters.push(filterObject);\n    selectedPage = 1;\n    renderFilters();\n};\n\nconst renderFilters = () => {\n    getCases();\n    const filtersMap = filters.map((filter) => {\n        if (filter.type === 'author') {\n            return {type: filter.type, value: filter.value.name};\n        } else {\n            return {type: filter.type, value: filter.value};\n        }\n    });\n    Templates.renderForPromise('local_digitalta/_common/filterList', {filters: filtersMap}).then(({html, js}) => {\n        Templates.replaceNodeContents(\"#filtersList\", html, js);\n    }).catch((error) => displayException(error));\n};\n\nconst getCases = async() => {\n    const mappedFilters = filters.map((filter) => {\n        if (filter.type === 'author') {\n            return {type: filter.type, value: filter.value.id};\n        }\n        return filter;\n    });\n\n    const casesRequest = {\n        methodname: 'local_digitalta_cases_get_paginated',\n        args: {\n            'pagenumber': selectedPage,\n            'filters': JSON.stringify(mappedFilters)\n        }\n    };\n    const casesResponse = await Ajax.call([casesRequest])[0];\n    console.log(casesResponse);\n    if (casesResponse.data.length === 0) {\n        Templates.renderForPromise('local_digitalta/_common/empty-view', casesResponse).then(({html, js}) => {\n            Templates.replaceNodeContents(\"#list-cases-body\", html, js);\n        }).catch((error) => displayException(error));\n    }else{\n        let paginationArray = generatePagination(casesResponse.pages, selectedPage);\n        const casesList = await Templates.renderForPromise('local_digitalta/cases/dashboard/case-list', {cases: casesResponse});\n        const pagination = await Templates.renderForPromise('local_digitalta/_common/pagination', {pages: paginationArray});\n        Templates.replaceNodeContents(\"#list-cases-body\", casesList.html, casesList.js);\n        Templates.replaceNodeContents(\"#digital-pagination\", pagination.html, pagination.js);\n    }\n};\n\nconst generatePagination = (totalPages, selectedPage) => {\n    let pagination = [];\n    for (let i = 0; i < totalPages; i++) {\n        let page = {\n            page: i + 1,\n            selected: i + 1 === selectedPage\n        };\n        pagination.push(page);\n    }\n    return pagination;\n};"],"names":["filters","selectedPage","getCases","on","e","stopPropagation","getAndRenderFilters","setActionsFilters","async","themesResponse","Ajax","call","methodname","args","tagsResponse","languajesResponse","templateFilterThemes","Templates","renderForPromise","templateFilterLanguajes","replaceNodeContents","html","js","availableTags","map","tag","name","input","this","val","toLowerCase","suggestions","filter","startsWith","templateFilterTags","tags","document","clickedPage","attr","parseInt","state","posibleNextPage","posiblePreviousPage","selectedText","text","length","element","addClass","removeClass","setFilter","filterText","type","value","request","courseid","enrolid","page","perpage","search","searchanywhere","response","empty","authorsSuggestions","users","id","click","is","hide","show","filterType","removeFilter","filterObject","index","findIndex","themeSelect","option","langSelect","splice","renderFilters","push","filtersMap","then","_ref","catch","error","mappedFilters","casesRequest","JSON","stringify","casesResponse","console","log","data","_ref2","paginationArray","generatePagination","pages","casesList","cases","pagination","totalPages","i","selected"],"mappings":"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"}