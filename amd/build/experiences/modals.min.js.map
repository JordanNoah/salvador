{"version":3,"file":"modals.min.js","sources":["../../src/experiences/modals.js"],"sourcesContent":["import {\r\n    autocompleteThemes\r\n} from \"local_digitalta/themes/autocomplete\";\r\nimport {\r\n    autocompleteTags\r\n} from \"local_digitalta/tags/autocomplete\";\r\nimport {\r\n    createTinyMCE,\r\n    getTinyMCEContent\r\n} from \"local_digitalta/tiny/manage\";\r\nimport {\r\n    showManageResourcesModal\r\n} from \"local_digitalta/resources/modals\";\r\nimport {\r\n    experiencesGet,\r\n    experiencesUpsert,\r\n    experiencesToggleStatus\r\n} from \"local_digitalta/repositories/experiences_repository\";\r\nimport {\r\n    resourcesGet,\r\n    resourcesAssign,\r\n    resourcesUnassign\r\n} from \"local_digitalta/repositories/resources_repository\";\r\nimport {\r\n    sectionsUpsert\r\n} from \"local_digitalta/repositories/sections_repository\";\r\nimport {\r\n    languagesGet\r\n} from \"local_digitalta/repositories/languages_repository\";\r\nimport {\r\n    getList\r\n} from \"core/normalise\";\r\nimport * as Cfg from \"core/config\";\r\nimport * as Str from \"core/str\";\r\nimport Modal from \"core/modal\";\r\nimport ModalEvents from \"core/modal_events\";\r\nimport ModalFactory from \"core/modal_factory\";\r\nimport ModalRegistry from \"core/modal_registry\";\r\nimport Notification from \"core/notification\";\r\n\r\nconst manageModal = class extends Modal {\r\n    static TYPE = 'local_digitalta/manageModal';\r\n    static TEMPLATE = 'local_digitalta/experiences/modals/modal-manage';\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(manageModal.TYPE, manageModal, manageModal.TEMPLATE);\r\n\r\nconst lockModal = class extends Modal {\r\n    static TYPE = 'local_digitalta/lockModal';\r\n    static TEMPLATE = 'local_digitalta/experiences/modals/modal-lock';\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(lockModal.TYPE, lockModal, lockModal.TEMPLATE);\r\n\r\nconst unlockModal = class extends Modal {\r\n    static TYPE = 'local_digitalta/unlockModal';\r\n    static TEMPLATE = 'local_digitalta/experiences/modals/modal-lock';\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(unlockModal.TYPE, unlockModal, unlockModal.TEMPLATE);\r\n\r\nconst manageReflectionModal = class extends Modal {\r\n    static TYPE = 'local_digitalta/manageReflectionModal';\r\n    static TEMPLATE = 'local_digitalta/experiences/modals/modal-reflection';\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(manageReflectionModal.TYPE, manageReflectionModal, manageReflectionModal.TEMPLATE);\r\n\r\nconst linkResourcesModal = class extends Modal {\r\n    static TYPE = \"local_digitalta/linkResourcesModal\";\r\n    static TEMPLATE = \"local_digitalta/experiences/modals/modal-resources\";\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(linkResourcesModal.TYPE, linkResourcesModal, linkResourcesModal.TEMPLATE);\r\n\r\nconst linkResourceModal = class extends Modal {\r\n    static TYPE = \"local_digitalta/linkResourceModal\";\r\n    static TEMPLATE = \"local_digitalta/experiences/modals/modal-resource-link\";\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(linkResourceModal.TYPE, linkResourceModal, linkResourceModal.TEMPLATE);\r\n\r\nconst unlinkResourceModal = class extends Modal {\r\n    static TYPE = 'local_digitalta/unlinkResourceModal';\r\n    static TEMPLATE = 'local_digitalta/experiences/modals/modal-resource-unlink';\r\n    registerEventListeners() {\r\n        super.registerEventListeners();\r\n        this.registerCloseOnSave();\r\n        this.registerCloseOnCancel();\r\n    }\r\n};\r\nModalRegistry.register(unlinkResourceModal.TYPE, unlinkResourceModal, unlinkResourceModal.TEMPLATE);\r\n\r\n// Manage modal\r\n\r\n/**\r\n * Display the manage modal for asking questions\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const showManageAskModal = async (experienceid = null) => {\r\n    const string_keys = [\r\n        { key: \"teacheracademy:actions:ask\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:description\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:title\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:title:placeholder\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:visibility\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:language\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:themes\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:tags\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:ask:picture\", component: \"local_digitalta\" },\r\n        { key: \"visibility:public\", component: \"local_digitalta\" },\r\n        { key: \"visibility:private\", component: \"local_digitalta\" }\r\n    ];\r\n    showManageModal(experienceid, string_keys);\r\n};\r\n\r\n/**\r\n * Display the manage modal for sharing experiences.\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const showManageShareModal = async (experienceid = null) => {\r\n    const string_keys = [\r\n        { key: \"teacheracademy:actions:share\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:description\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:title\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:title:placeholder\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:visibility\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:language\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:themes\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:tags\", component: \"local_digitalta\" },\r\n        { key: \"teacheracademy:actions:share:picture\", component: \"local_digitalta\" },\r\n        { key: \"visibility:public\", component: \"local_digitalta\" },\r\n        { key: \"visibility:private\", component: \"local_digitalta\" }\r\n    ];\r\n    showManageModal(experienceid, string_keys);\r\n};\r\n\r\n/**\r\n * Display the manage modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n * @param {Array} string_keys The string keys to display.\r\n */\r\nexport const showManageModal = async (experienceid = null, string_keys) => {\r\n    // Strings\r\n    const strings = await Str.get_strings(string_keys);\r\n    // Languages\r\n    const languages = await languagesGet({prioritizeInstalled: true});\r\n    // Experience\r\n    const experience = experienceid === null\r\n        ? Promise.resolve({})\r\n        : await experiencesGet(experienceid).then((response) => response.experience);\r\n    Promise.all([strings, languages, experience])\r\n        .then(([strings, languages, experience]) =>\r\n            displayManageModal(strings, languages, experience));\r\n};\r\n\r\n/**\r\n * Display the manage modal.\r\n *\r\n * @param {Array} strings The strings to display.\r\n * @param {Array} languages The list of available languages.\r\n * @param {Object} experience The experience object.\r\n *\r\n */\r\nexport const displayManageModal = async (strings, languages, experience = {}) => {\r\n    // Languages\r\n    let anyLanguageSelected = false;\r\n    languages = languages.map((language) => {\r\n        language.selected = false;\r\n        if (experience.hasOwnProperty('lang') && language.code === experience.lang) {\r\n            language.selected = anyLanguageSelected = true;\r\n        }\r\n        return {\r\n            key: language.code,\r\n            value: language.name,\r\n            selected: language.selected\r\n        };\r\n    });\r\n    if (!anyLanguageSelected) {\r\n        languages[0].selected = true;\r\n    }\r\n    // Sections\r\n    let sections = {};\r\n    if (experience.sections) {\r\n        experience.sections.forEach((section) => {\r\n            sections[section.groupname_simplified] = section;\r\n        });\r\n    }\r\n    experience.sections = sections;\r\n    // Visibility\r\n    let visibility = [\r\n        { key: 1, value: strings[9] },\r\n        { key: 0, value: strings[10] }\r\n    ];\r\n    let anyVisibilitySelected = false;\r\n    visibility = visibility.map((item) => {\r\n        item.selected = false;\r\n        if (experience.hasOwnProperty('visible') && item.key === experience.visible) {\r\n            item.selected = anyVisibilitySelected = true;\r\n        }\r\n        return {\r\n            key: item.key,\r\n            value: item.value,\r\n            selected: item.key === experience.visible\r\n        };\r\n    });\r\n    if (!anyVisibilitySelected) {\r\n        visibility[0].selected = true;\r\n    }\r\n    const modal = await ModalFactory.create({\r\n        type: manageModal.TYPE,\r\n        templateContext: {\r\n            modal: {\r\n                title: strings[0],\r\n                description: strings[1],\r\n                sections: {\r\n                    title: {\r\n                        label: strings[2],\r\n                        placeholder: strings[3]\r\n                    },\r\n                    visibility: {\r\n                        label: strings[4]\r\n                    },\r\n                    language: {\r\n                        label: strings[5]\r\n                    },\r\n                    themes: {\r\n                        label: strings[6]\r\n                    },\r\n                    tags: {\r\n                        label: strings[7]\r\n                    },\r\n                    picture: {\r\n                        label: strings[8]\r\n                    }\r\n                },\r\n                visibility: visibility,\r\n                languages: languages\r\n            },\r\n            current: {\r\n                id: experience.id ?? 0,\r\n                title: experience.title ?? null,\r\n                visible: experience.visible ?? null,\r\n                lang: experience.lang ?? null,\r\n                sections: experience.sections ?? [],\r\n                tags: experience.tags ?? [],\r\n                themes: experience.themes ?? []\r\n            }\r\n        },\r\n        large: true,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    createTinyMCE('experience-manage-reflection-what-content');\r\n    autocompleteTags('#experience-manage-tags');\r\n    autocompleteThemes('#experience-manage-themes');\r\n    $root.on(ModalEvents.save, (event, modal) => {\r\n        event.preventDefault();\r\n        const form = $root[0].querySelector('form');\r\n        if (validateManageRequiredFields(form)) {\r\n            handleManageModalSubmission(event, modal);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Handle the submission of the modal.\r\n *\r\n * @param {Event} event\r\n * @param {Modal} modal\r\n */\r\nconst handleManageModalSubmission = async (event, modal) => {\r\n    const form = getList(modal.getRoot())[0].querySelector(\"form\");\r\n    if (!form) {\r\n        return;\r\n    }\r\n    const formData = {\r\n        id: form.querySelector('input[name=\"experience-manage-id\"]').value,\r\n        title: form.querySelector('input[name=\"experience-manage-title\"]').value,\r\n        visible: form.querySelector('select[name=\"experience-manage-visibility\"]').value,\r\n        lang: form.querySelector('select[name=\"experience-manage-lang\"]').value,\r\n        sections: [\r\n            {\r\n                id: form.querySelector('textarea[name=\"experience-manage-reflection-what-content\"]')\r\n                    .getAttribute('data-id') || null,\r\n                groupid: form.querySelector('textarea[name=\"experience-manage-reflection-what-content\"]')\r\n                    .getAttribute('data-groupid') || null,\r\n                groupname: form.querySelector('textarea[name=\"experience-manage-reflection-what-content\"]')\r\n                    .getAttribute('data-groupname') || null,\r\n                typename: 'text',\r\n                content: getTinyMCEContent('experience-manage-reflection-what-content')\r\n            }\r\n        ],\r\n        themes: Array.from(\r\n            form.querySelectorAll('select[name=\"experience-manage-themes\"] option:checked'),\r\n            option => option.value),\r\n        tags: Array.from(\r\n            form.querySelectorAll('select[name=\"experience-manage-tags\"] option:checked'),\r\n            option => option.value)\r\n    };\r\n    try {\r\n        const response = await experiencesUpsert(formData);\r\n        Notification.addNotification({\r\n            message: \"Experience saved successfully.\",\r\n            type: 'success'\r\n        });\r\n        location.href = Cfg.wwwroot + '/local/digitalta/pages/experiences/view.php?id=' + response.experienceid;\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n};\r\n\r\n/**\r\n * Validate required fields.\r\n *\r\n * @param {HTMLElement} form The form to validate.\r\n * @return {boolean} True if all required fields are filled.\r\n */\r\nconst validateManageRequiredFields = (form) => {\r\n    const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');\r\n    for (const field of requiredFields) {\r\n        if (!field.value) {\r\n            field.focus();\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n};\r\n\r\n// Lock and unlock modals\r\n\r\n/**\r\n * Display the lock modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const showLockModal = async (experienceid) => {\r\n    const string_keys = [\r\n        { key: \"experience:lock\", component: \"local_digitalta\" },\r\n        { key: \"experience:lock:confirm\", component: \"local_digitalta\" }\r\n    ];\r\n    const strings = Str.get_strings(string_keys);\r\n    Promise.all([strings])\r\n        .then(([strings]) => displayLockModal(strings, experienceid));\r\n};\r\n\r\n/**\r\n * Display the unlock modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const showUnlockModal = async (experienceid) => {\r\n    const string_keys = [\r\n        { key: \"experience:unlock\", component: \"local_digitalta\" },\r\n        { key: \"experience:unlock:confirm\", component: \"local_digitalta\" }\r\n    ];\r\n    const strings = Str.get_strings(string_keys);\r\n    Promise.all([strings])\r\n        .then(([strings]) => displayLockModal(strings, experienceid));\r\n};\r\n\r\n/**\r\n * Display the lock/unlock modal.\r\n *\r\n * @param {Array} strings The strings to display.\r\n * @param {int} experienceid The experience id.\r\n */\r\nconst displayLockModal = async (strings, experienceid) => {\r\n    const modal = await ModalFactory.create({\r\n        type: lockModal.TYPE,\r\n        templateContext: {\r\n            modal: {\r\n                title: strings[0],\r\n                description: strings[1]\r\n            }\r\n        },\r\n        large: false,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    $root.on(ModalEvents.save, (event) => {\r\n        event.preventDefault();\r\n        experiencesToggleStatus(experienceid);\r\n        modal.destroy();\r\n        window.location.reload();\r\n    });\r\n};\r\n\r\n// Manage reflection modal\r\n\r\n/**\r\n * Display the manage reflection modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const showManageReflectionModal = async (experienceid) => {\r\n    // Strings\r\n    const string_keys = [\r\n        { key: \"experience:reflection:title\", component: \"local_digitalta\" },\r\n        { key: \"experience:reflection:description\", component: \"local_digitalta\" }\r\n    ];\r\n    const strings = Str.get_strings(string_keys);\r\n    // Experience\r\n    const experience = experienceid === null\r\n        ? Promise.resolve({})\r\n        : await experiencesGet(experienceid).then((response) => response.experience);\r\n    Promise.all([strings, experience])\r\n        .then(([strings, experience]) => displayManageReflectionModal(strings, experience));\r\n};\r\n\r\n/**\r\n * Display the manage reflection modal.\r\n *\r\n * @param {Array} strings The strings to display.\r\n * @param {Object} experience The experience object.\r\n */\r\nexport const displayManageReflectionModal = async (strings, experience) => {\r\n    let sections = {};\r\n    experience.sections.forEach((section) => {\r\n        sections[section.groupname_simplified] = section;\r\n    });\r\n    experience.sections = sections;\r\n    const modal = await ModalFactory.create({\r\n        type: manageReflectionModal.TYPE,\r\n        templateContext: {\r\n            modal: {\r\n                title: strings[0],\r\n                description: strings[1]\r\n            },\r\n            experienceid: experience.id ?? 0,\r\n            sections: experience.sections ?? []\r\n        },\r\n        large: true,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    createTinyMCE('experience-manage-reflection-what-content');\r\n    createTinyMCE('experience-manage-reflection-so_what-content');\r\n    createTinyMCE('experience-manage-reflection-now_what-content');\r\n    $root.on(ModalEvents.save, (event, modal) => {\r\n        event.preventDefault();\r\n        const form = $root[0].querySelector('form');\r\n        if (validateManageRequiredFields(form)) {\r\n            handleManageReflectionModalSubmission(event, modal);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Handle the submission of the modal.\r\n *\r\n * @param {Event} event\r\n * @param {Modal} modal\r\n */\r\nconst handleManageReflectionModalSubmission = async (event, modal) => {\r\n    const form = getList(modal.getRoot())[0].querySelector(\"form\");\r\n    if (!form) {\r\n        return;\r\n    }\r\n    const formData = {\r\n        id: form.querySelector('input[name=\"experience-manage-id\"]').value,\r\n        sections: [\r\n            {\r\n                id: form.querySelector('textarea[name=\"experience-manage-reflection-what-content\"]')\r\n                    .getAttribute('data-id'),\r\n                groupid: form.querySelector('textarea[name=\"experience-manage-reflection-what-content\"]')\r\n                    .getAttribute('data-groupid'),\r\n                content: getTinyMCEContent('experience-manage-reflection-what-content')\r\n            },\r\n            {\r\n                id: form.querySelector('textarea[name=\"experience-manage-reflection-so_what-content\"]')\r\n                    .getAttribute('data-id'),\r\n                groupid: form.querySelector('textarea[name=\"experience-manage-reflection-so_what-content\"]')\r\n                    .getAttribute('data-groupid'),\r\n                content: getTinyMCEContent('experience-manage-reflection-so_what-content')\r\n            },\r\n            {\r\n                id: form.querySelector('textarea[name=\"experience-manage-reflection-now_what-content\"]')\r\n                    .getAttribute('data-id'),\r\n                groupid: form.querySelector('textarea[name=\"experience-manage-reflection-now_what-content\"]')\r\n                    .getAttribute('data-groupid'),\r\n                content: getTinyMCEContent('experience-manage-reflection-now_what-content')\r\n            }\r\n        ]\r\n    };\r\n    try {\r\n        let promises = [];\r\n        for (const section of formData.sections) {\r\n            promises.push(sectionsUpsert({\r\n                'id': section.id,\r\n                'component': 'experience',\r\n                'componentinstance': formData.id,\r\n                'groupid': section.groupid,\r\n                'groupname': null,\r\n                'sequence': null,\r\n                'type': null,\r\n                'typename': 'text',\r\n                'title': null,\r\n                'content': section.content\r\n            }));\r\n        }\r\n        await Promise.all(promises);\r\n        Notification.addNotification({\r\n            message: \"Reflection saved successfully.\",\r\n            type: 'success'\r\n        });\r\n        location.href = Cfg.wwwroot + '/local/digitalta/pages/experiences/view.php?id=' + formData.id;\r\n    } catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n};\r\n\r\n// Link resources modal\r\n\r\n/**\r\n * Display the link resources modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n */\r\nexport const displayLinkResourcesModal = async (experienceid = null) => {\r\n    const { resources } = await resourcesGet({});\r\n    const modal = await ModalFactory.create({\r\n        type: linkResourcesModal.TYPE,\r\n        templateContext: {\r\n            experienceid: experienceid,\r\n            resources\r\n        },\r\n        large: true,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    const changeElement = $root.find(\"#changeToManageResource\").get(0);\r\n    if (changeElement) {\r\n        changeElement.onclick = () => {\r\n            showManageResourcesModal(null, experienceid);\r\n            modal.destroy();\r\n        };\r\n    }\r\n};\r\n\r\n/**\r\n * Display the link resource modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n * @param {int} resourceid The resource id.\r\n */\r\nexport const displayLinkResourceModal = async (experienceid, resourceid) => {\r\n    // Resource\r\n    const resource = await resourcesGet({id: resourceid})\r\n        .then((response) => { return response.resources[0]; });\r\n    const modal = await ModalFactory.create({\r\n        type: linkResourceModal.TYPE,\r\n        templateContext: {\r\n            experienceid: experienceid,\r\n            resourceid: resource.id,\r\n            resourcename: resource.name\r\n        },\r\n        large: true,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    createTinyMCE('experience-link-resource-description');\r\n    $root.on(ModalEvents.save, (event, modal) => {\r\n        handleLinkResourceModalSubmission(event, modal);\r\n    });\r\n};\r\n\r\n/**\r\n * Handle the submission of the modal.\r\n *\r\n * @param {Event} event\r\n * @param {Modal} modal\r\n */\r\nconst handleLinkResourceModalSubmission = async (event, modal) => {\r\n    const form = getList(modal.getRoot())[0].querySelector(\"form\");\r\n    if (!form) {\r\n        return;\r\n    }\r\n    const formData = {\r\n        resourceid: form.querySelector('input[name=\"resourceid\"]').value,\r\n        component: 'experience',\r\n        componentinstance: form.querySelector('input[name=\"experienceid\"]').value,\r\n        description: getTinyMCEContent('experience-link-resource-description')\r\n    };\r\n    try {\r\n        await resourcesAssign(formData);\r\n        Notification.addNotification({\r\n            message: \"Resource linked successfully.\",\r\n            type: 'success'\r\n        });\r\n        location.reload();\r\n    }\r\n    catch (error) {\r\n        Notification.exception(error);\r\n    }\r\n};\r\n\r\n/**\r\n * Display the unlink resource modal.\r\n *\r\n * @param {int} experienceid The experience id.\r\n * @param {int} resourceid The resource id.\r\n */\r\nexport const showUnlinkResourceModal = async (experienceid, resourceid) => {\r\n    const string_keys = [\r\n        { key: \"experience:resources:unlink\", component: \"local_digitalta\" },\r\n        { key: \"experience:resources:unlink:confirm\", component: \"local_digitalta\" }\r\n    ];\r\n    const strings = Str.get_strings(string_keys);\r\n    Promise.all([strings])\r\n        .then(([strings]) => displayUnlinkResourceModal(strings, experienceid, resourceid));\r\n};\r\n\r\n/**\r\n * Display the unlink resource modal.\r\n *\r\n * @param {Array} strings The strings to display.\r\n * @param {int} experienceid The experience id.\r\n * @param {int} resourceid The resource id.\r\n */\r\nconst displayUnlinkResourceModal = async (strings, experienceid, resourceid) => {\r\n    const modal = await ModalFactory.create({\r\n        type: lockModal.TYPE,\r\n        templateContext: {\r\n            modal: {\r\n                title: strings[0],\r\n                description: strings[1]\r\n            }\r\n        },\r\n        large: false,\r\n        removeOnClose: true\r\n    });\r\n    modal.show();\r\n    const $root = modal.getRoot();\r\n    $root.on(ModalEvents.save, async (event, modal) => {\r\n        event.preventDefault();\r\n        try {\r\n            await resourcesUnassign({\r\n                id: resourceid,\r\n                component: 'experience',\r\n                componentinstance: experienceid\r\n            });\r\n            Notification.addNotification({\r\n                message: \"Resource unlinked successfully.\",\r\n                type: 'success'\r\n            });\r\n            modal.destroy();\r\n            window.location.reload();\r\n        } catch (error) {\r\n            Notification.exception(error);\r\n        }\r\n    });\r\n};\r\n"],"names":["manageModal","Modal","registerEventListeners","registerCloseOnSave","registerCloseOnCancel","register","TYPE","TEMPLATE","lockModal","unlockModal","manageReflectionModal","linkResourcesModal","linkResourceModal","unlinkResourceModal","async","experienceid","string_keys","key","component","showManageModal","strings","Str","get_strings","languages","prioritizeInstalled","experience","Promise","resolve","then","response","all","_ref","displayManageModal","anyLanguageSelected","map","language","selected","hasOwnProperty","code","lang","value","name","sections","forEach","section","groupname_simplified","visibility","anyVisibilitySelected","item","visible","modal","ModalFactory","create","type","templateContext","title","description","label","placeholder","themes","tags","picture","current","id","large","removeOnClose","show","$root","getRoot","on","ModalEvents","save","event","preventDefault","form","querySelector","validateManageRequiredFields","handleManageModalSubmission","formData","getAttribute","groupid","groupname","typename","content","Array","from","querySelectorAll","option","addNotification","message","location","href","Cfg","wwwroot","error","exception","requiredFields","field","focus","_ref2","displayLockModal","_ref3","destroy","window","reload","_ref4","displayManageReflectionModal","handleManageReflectionModalSubmission","promises","push","resources","changeElement","find","get","onclick","resourceid","resource","resourcename","handleLinkResourceModalSubmission","componentinstance","_ref5","displayUnlinkResourceModal"],"mappings":"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"}