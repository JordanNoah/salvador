define("local_digitalta/experiences/provider",["exports","core/notification","core/templates","jquery","core/ajax"],(function(_exports,_notification,_templates,_jquery,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);let pages=0,filters=[],selectedPage=1;_exports.init=()=>{getAndRenderFilters(),getExperiences(),(0,_jquery.default)(".dropdown-menu").on("click",(function(e){e.stopPropagation()})),(0,_jquery.default)(document).on("click","li.page-item.page-link.page",(function(){const clickedPage=(0,_jquery.default)(this).attr("attr-page");selectedPage!==clickedPage&&(selectedPage=parseInt(clickedPage),getExperiences())})),(0,_jquery.default)(document).on("click","li.page-item.page-link.state",(function(){const state=(0,_jquery.default)(this).attr("aria-label");if("Next"===state){const posibleNextPage=selectedPage+1;posibleNextPage>0&&posibleNextPage<=pages&&(selectedPage++,getExperiences())}else if("Previous"===state){const posiblePreviousPage=selectedPage-1;posiblePreviousPage>0&&posiblePreviousPage<=pages&&(selectedPage--,getExperiences())}})),(0,_jquery.default)(document).on("change",".filterThemeSelect",(function(){const selectedText=(0,_jquery.default)("option:selected.enable",this).text();if(selectedText.length>0){const element=(0,_jquery.default)("option:selected.enable",this);element.addClass("disabled"),element.removeClass("enable"),console.log(element);setFilter({type:"theme",value:selectedText})}})),(0,_jquery.default)(document).on("keydown","#inlineFormInputGroup",(function(event){if("Enter"===event.key||13===event.keyCode){const filterText=(0,_jquery.default)(this).val();setFilter({type:"tag",value:filterText}),(0,_jquery.default)(this).val("")}})),(0,_jquery.default)(document).on("keydown","#autorFilters",(async function(){const request={methodname:"core_enrol_get_potential_users",args:{courseid:1,enrolid:1,page:0,perpage:10,search:(0,_jquery.default)(this).val(),searchanywhere:!0}},response=await _ajax.default.call([request])[0],authorsSuggestions=await _templates.default.renderForPromise("local_digitalta/_common/listAutors",{users:response});_templates.default.replaceNodeContents("#suggestionsAutors",authorsSuggestions.html,authorsSuggestions.js),console.log(authorsSuggestions),console.log(response)})),(0,_jquery.default)(".tagsInputFilter").on("click",(function(){console.log((0,_jquery.default)(this))})),(0,_jquery.default)(document).on("click","#removeFilter",(function(){const filterText=(0,_jquery.default)(this).attr("attr-filter"),filterType=(0,_jquery.default)(this).attr("attr-type");removeFilter({type:filterType,value:filterText})}))};const getExperiences=async()=>{const request={methodname:"local_digitalta_experiences_get_by_pagination",args:{pagenumber:selectedPage,filters:JSON.stringify(filters)}},response=await _ajax.default.call([request])[0];if(0===response.data.length)_templates.default.renderForPromise("local_digitalta/_common/empty-view",response).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents("#list-experience-body",html,js)})).catch((error=>(0,_notification.exception)(error)));else{let obj={experiences:response},paginationArray=generatePagination(response.pages,selectedPage);const experienceList=await _templates.default.renderForPromise("local_digitalta/experiences/dashboard/experience-list",obj);pages=response.pages;const pagination=await _templates.default.renderForPromise("local_digitalta/_common/pagination",{pages:paginationArray});_templates.default.replaceNodeContents("#list-experience-body",experienceList.html,experienceList.js),_templates.default.replaceNodeContents("#digital-pagination",pagination.html,pagination.js)}},generatePagination=(totalPages,selectedPage)=>{let pagination=[];for(let i=0;i<totalPages;i++){let page={page:i+1,selected:i+1===selectedPage};pagination.push(page)}return pagination},getAndRenderFilters=async()=>{const themesResponse=await _ajax.default.call([{methodname:"local_digitalta_themes_get",args:{}}])[0],tagsResponse=await _ajax.default.call([{methodname:"local_digitalta_tags_get",args:{}}])[0],languajesResponse=await _ajax.default.call([{methodname:"local_digitalta_experiences_get_used_langs",args:{}}])[0],templateFilterThemes=await _templates.default.renderForPromise("local_digitalta/_common/filterTheme",{themes:themesResponse}),templateFilterLanguajes=await _templates.default.renderForPromise("local_digitalta/_common/filterLanguajes",{languajes:languajesResponse});_templates.default.replaceNodeContents("#filterThemeSelect",templateFilterThemes.html,templateFilterThemes.js),_templates.default.replaceNodeContents("#filterLanguajeSelect",templateFilterLanguajes.html,templateFilterLanguajes.js);const availableTags=tagsResponse.map((function(tag){return tag.name}));(0,_jquery.default)("#inlineFormInputGroup").on("input",(function(){var input=(0,_jquery.default)(this).val().toLowerCase(),suggestions=availableTags.filter((function(tag){return tag.toLowerCase().startsWith(input)}));showSuggestions(suggestions)}))},showSuggestions=suggestions=>{(0,_jquery.default)(".autocomplete-suggestions").remove();var suggestionList=(0,_jquery.default)('<ul class="autocomplete-suggestions list-group list-group-tags" id="list-group-tags"></ul>');if(0===suggestions.length){var item=(0,_jquery.default)('<li class="list-group-item">No hay sugerencias</li>');suggestionList.append(item)}else suggestions.forEach((function(suggestion){var item=(0,_jquery.default)('<li class="list-group-item tagFilters enable">'+suggestion+"</li>");item.on("click",(function(){(0,_jquery.default)("#inlineFormInputGroup").val(suggestion),suggestionList.remove()})),suggestionList.append(item)})),(0,_jquery.default)(".autocomplete-wrapper").append(suggestionList)},setFilter=filterObject=>{filters.push(filterObject),selectedPage=1,renderFilters()},removeFilter=filterObject=>{const index=filters.findIndex((filter=>filter.type===filterObject.type&&filter.value===filterObject.value));if(index>-1){if("theme"===filterObject.type){let themeSelect=(0,_jquery.default)("#filterThemes"),option=(0,_jquery.default)('option[value="'+filterObject.value+'"].disabled',themeSelect);option.removeClass("disabled"),option.addClass("enable")}filters.splice(index,1),selectedPage=1,renderFilters()}},renderFilters=()=>{getExperiences(),_templates.default.renderForPromise("local_digitalta/_common/filterList",{filters:filters}).then((_ref2=>{let{html:html,js:js}=_ref2;_templates.default.replaceNodeContents("#filtersList",html,js)})).catch((error=>(0,_notification.exception)(error)))}}));

//# sourceMappingURL=provider.min.js.map