{"version":3,"file":"provider.min.js","sources":["../../src/experiences/provider.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nlet pages = 0;\n\nlet filters = [];\nlet selectedPage = 1;\nexport const init = () => {\n    getAndRenderFilters();\n    getExperiences();\n\n    $('.dropdown-menu').on('click', function(e) {\n        e.stopPropagation();\n    });\n\n    $(document).on(\"click\", \"li.page-item.page-link.page\", function() {\n        const clickedPage = $(this).attr('attr-page');\n        if (selectedPage !== clickedPage) {\n            selectedPage = parseInt(clickedPage);\n            getExperiences();\n        }\n    });\n    $(document).on(\"click\", \"li.page-item.page-link.state\", function() {\n        const state = $(this).attr('aria-label');\n        if (state === 'Next') {\n            const posibleNextPage = selectedPage + 1;\n            if (posibleNextPage > 0 && posibleNextPage <= pages) {\n                selectedPage++;\n                getExperiences();\n            }\n        } else if (state === 'Previous') {\n            const posiblePreviousPage = selectedPage - 1;\n            if (posiblePreviousPage > 0 && posiblePreviousPage <= pages) {\n                selectedPage--;\n                getExperiences();\n            }\n        }\n    });\n\n    $(document).on(\"change\", \".filterThemeSelect\", function() {\n        //const selectedValue = $(this).val();\n        const selectedText = $(\"option:selected.enable\", this).text();\n        if (selectedText.length > 0) {\n            const element = $(\"option:selected.enable\", this);\n            element.addClass('disabled');\n            element.removeClass('enable');\n            console.log(element);\n            const filterObject = {\"type\": \"theme\", \"value\": selectedText};\n            setFilter(filterObject);\n        }\n    });\n\n    $(document).on(\"keydown\", \"#inlineFormInputGroup\", function(event) {\n        // Verificamos si la tecla Enter fue presionada (keyCode 13 o event.which 13)\n        if (event.key === \"Enter\" || event.keyCode === 13) {\n            const filterText = $(this).val(); // Obtenemos el valor del input\n            const filterObject = {\"type\": \"tag\", \"value\": filterText};\n            setFilter(filterObject);\n            $(this).val(''); // Limpiamos el input\n        }\n    });\n\n    $(document).on(\"keydown\", \"#autorFilters\", async function() {\n        const filterText = $(this).val(); // Obtenemos el valor del input\n        const request = {\n            methodname: 'core_enrol_get_potential_users',\n            args: {courseid: 1, enrolid: 1, page: 0, perpage: 10, search: filterText, searchanywhere: true}\n        };\n        const response = await Ajax.call([request])[0];\n\n        const authorsSuggestions = await Templates.renderForPromise('local_digitalta/_common/listAutors', {users: response});\n        Templates.replaceNodeContents(\"#suggestionsAutors\", authorsSuggestions.html, authorsSuggestions.js);\n\n\n        console.log(authorsSuggestions);\n        console.log(response);\n    });\n\n    $(\".tagsInputFilter\").on(\"click\", function() {\n        console.log($(this));\n    });\n\n\n    $(document).on(\"click\", \"#removeFilter\", function() {\n        const filterText = $(this).attr('attr-filter');\n        const filterType = $(this).attr('attr-type');\n        const filterObject = {\"type\": filterType, \"value\": filterText};\n        removeFilter(filterObject);\n    });\n};\n\nconst getExperiences = async() => {\n    const request = {\n        methodname: 'local_digitalta_experiences_get_by_pagination',\n        args: {\n            'pagenumber': selectedPage,\n            'filters': JSON.stringify(filters)\n        }\n    };\n    const response = await Ajax.call([request])[0];\n\n    if (response.data.length === 0) {\n        Templates.renderForPromise('local_digitalta/_common/empty-view', response).then(({html, js}) => {\n            Templates.replaceNodeContents(\"#list-experience-body\", html, js);\n        }).catch((error) => displayException(error));\n    } else {\n        let obj = {\"experiences\": response};\n        let paginationArray = generatePagination(response.pages, selectedPage);\n        const experienceList = await Templates.renderForPromise('local_digitalta/experiences/dashboard/experience-list',\n            obj\n        );\n        pages = response.pages;\n        const pagination = await Templates.renderForPromise('local_digitalta/_common/pagination', {\"pages\": paginationArray});\n        Templates.replaceNodeContents(\"#list-experience-body\", experienceList.html, experienceList.js);\n        Templates.replaceNodeContents(\"#digital-pagination\", pagination.html, pagination.js);\n    }\n};\n\nconst generatePagination = (totalPages, selectedPage) => {\n    let pagination = [];\n    for (let i = 0; i < totalPages; i++) {\n        let page = {\n            page: i + 1,\n            selected: i + 1 === selectedPage\n        };\n        pagination.push(page);\n    }\n    return pagination;\n};\n\nconst getAndRenderFilters = async() => {\n    const themesRequest = {\n        methodname: 'local_digitalta_themes_get',\n        args: {}\n    };\n    const tagsRequest = {methodname: 'local_digitalta_tags_get', args: {}};\n    const languajesRequest = {methodname: 'local_digitalta_experiences_get_used_langs', args: {}};\n    const themesResponse = await Ajax.call([themesRequest])[0];\n    const tagsResponse = await Ajax.call([tagsRequest])[0];\n    const languajesResponse = await Ajax.call([languajesRequest])[0];\n\n    // eslint-disable-next-line max-len\n    const templateFilterThemes = await Templates.renderForPromise('local_digitalta/_common/filterTheme', {\"themes\": themesResponse});\n    // eslint-disable-next-line max-len\n    const templateFilterLanguajes = await Templates.renderForPromise('local_digitalta/_common/filterLanguajes', {\"languajes\": languajesResponse});\n    Templates.replaceNodeContents(\"#filterThemeSelect\", templateFilterThemes.html, templateFilterThemes.js);\n    Templates.replaceNodeContents(\"#filterLanguajeSelect\", templateFilterLanguajes.html, templateFilterLanguajes.js);\n\n    const availableTags = tagsResponse.map(function(tag) {\n        return tag.name;\n    });\n\n    // Evento de entrada en el campo de texto\n    $('#inlineFormInputGroup').on('input', function() {\n        var input = $(this).val().toLowerCase();\n        var suggestions = availableTags.filter(function(tag) {\n            return tag.toLowerCase().startsWith(input);\n        });\n\n        // Mostrar sugerencias\n        showSuggestions(suggestions);\n    });\n\n\n};\n\nconst showSuggestions = (suggestions) => {\n    // Eliminar las sugerencias anteriores\n    $('.autocomplete-suggestions').remove();\n\n    // Crear una lista para las sugerencias\n    var suggestionList = $('<ul class=\"autocomplete-suggestions list-group list-group-tags\" id=\"list-group-tags\"></ul>');\n    if (suggestions.length === 0) {\n        var item = $('<li class=\"list-group-item\">No hay sugerencias</li>');\n        suggestionList.append(item);\n    } else {\n        suggestions.forEach(function(suggestion) {\n            var item = $('<li class=\"list-group-item tagFilters enable\">' + suggestion + '</li>');\n            item.on('click', function() {\n                $('#inlineFormInputGroup').val(suggestion);\n                suggestionList.remove(); // Eliminar la lista de sugerencias al seleccionar\n            });\n            suggestionList.append(item);\n        });\n\n        // Añadir la lista de sugerencias justo después del input\n        $('.autocomplete-wrapper').append(suggestionList);\n    }\n};\n\nconst setFilter = (filterObject) => {\n    filters.push(filterObject);\n    selectedPage = 1;\n    renderFilters();\n};\n\nconst removeFilter = (filterObject) => {\n    const index = filters.findIndex((filter) => {\n        return filter.type === filterObject.type && filter.value === filterObject.value;\n    });\n    if (index > -1) {\n        if (filterObject.type === 'theme') {\n            let themeSelect = $(\"#filterThemes\");\n            let option = $('option[value=\"'+filterObject.value+'\"].disabled', themeSelect);\n            option.removeClass('disabled');\n            option.addClass('enable');\n        }\n        filters.splice(index, 1);\n        selectedPage = 1;\n        renderFilters();\n    }\n};\n\nconst renderFilters = () => {\n    getExperiences();\n    Templates.renderForPromise('local_digitalta/_common/filterList', {filters: filters}).then(({html, js}) => {\n        Templates.replaceNodeContents(\"#filtersList\", html, js);\n    }).catch((error) => displayException(error));\n};"],"names":["pages","filters","selectedPage","getAndRenderFilters","getExperiences","on","e","stopPropagation","document","clickedPage","this","attr","parseInt","state","posibleNextPage","posiblePreviousPage","selectedText","text","length","element","addClass","removeClass","console","log","setFilter","event","key","keyCode","filterText","val","async","request","methodname","args","courseid","enrolid","page","perpage","search","searchanywhere","response","Ajax","call","authorsSuggestions","Templates","renderForPromise","users","replaceNodeContents","html","js","filterType","removeFilter","JSON","stringify","data","then","_ref","catch","error","obj","paginationArray","generatePagination","experienceList","pagination","totalPages","i","selected","push","themesResponse","tagsResponse","languajesResponse","templateFilterThemes","templateFilterLanguajes","availableTags","map","tag","name","input","toLowerCase","suggestions","filter","startsWith","showSuggestions","remove","suggestionList","item","append","forEach","suggestion","filterObject","renderFilters","index","findIndex","type","value","themeSelect","option","splice","_ref2"],"mappings":"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"}