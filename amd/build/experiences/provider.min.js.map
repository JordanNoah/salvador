{"version":3,"file":"provider.min.js","sources":["../../src/experiences/provider.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\r\nimport Templates from 'core/templates';\r\nimport $ from 'jquery';\r\nimport Ajax from 'core/ajax';\r\nlet pages = 0;\r\n\r\nlet filters = [];\r\nlet selectedPage = 1;\r\nexport const init = () => {\r\n    getAndRenderFilters();\r\n    getExperiences();\r\n\r\n    $('.dropdown-menu').on('click', function(e) {\r\n        e.stopPropagation();\r\n    });\r\n\r\n    $(document).on(\"click\", \"li.page-item.page-link.page\", function() {\r\n        const clickedPage = $(this).attr('attr-page');\r\n        if (selectedPage !== clickedPage) {\r\n            selectedPage = parseInt(clickedPage);\r\n            getExperiences();\r\n        }\r\n    });\r\n    $(document).on(\"click\", \"li.page-item.page-link.state\", function() {\r\n        const state = $(this).attr('aria-label');\r\n        if (state === 'Next') {\r\n            const posibleNextPage = selectedPage + 1;\r\n            if (posibleNextPage > 0 && posibleNextPage <= pages) {\r\n                selectedPage++;\r\n                getExperiences();\r\n            }\r\n        } else if (state === 'Previous') {\r\n            const posiblePreviousPage = selectedPage - 1;\r\n            if (posiblePreviousPage > 0 && posiblePreviousPage <= pages) {\r\n                selectedPage--;\r\n                getExperiences();\r\n            }\r\n        }\r\n    });\r\n\r\n    $(document).on(\"change\", \".filterThemeSelect\", function() {\r\n        const selectedValue = $(\"option:selected.enable\", this).val();\r\n        const selectedText = $(\"option:selected.enable\", this).text();\r\n        if (selectedText.length > 0) {\r\n            const element = $(\"option:selected.enable\", this);\r\n            element.addClass('disabled');\r\n            element.removeClass('enable');\r\n            const filterObject = {\"type\": \"theme\", \"value\": {id: selectedValue, name: selectedText}};\r\n            setFilter(filterObject);\r\n            $(\".filterThemeSelect option:first\").prop(\"selected\", true);\r\n            $(element).prop('disabled', true);\r\n        }\r\n    });\r\n\r\n    $(document).on(\"change\", \".filterLanguajeSelect\", function() {\r\n        const selectedText = $(\"option:selected.enable\", this).text();\r\n        if (selectedText.length > 0) {\r\n            const element = $(\"option:selected.enable\", this);\r\n            element.addClass('disabled');\r\n            element.removeClass('enable');\r\n            const filterObject = {\"type\": \"languaje\", \"value\": selectedText};\r\n            setFilter(filterObject);\r\n            $(\".filterLanguajeSelect option:first\").prop(\"selected\", true);\r\n            $(element).prop('disabled', true);\r\n        }\r\n    });\r\n\r\n    $(document).on(\"keydown\", \"#inlineFormInputGroup\", function(event) {\r\n        // Verificamos si la tecla Enter fue presionada (keyCode 13 o event.which 13)\r\n        if (event.key === \"Enter\" || event.keyCode === 13) {\r\n            const filterText = $(this).val(); // Obtenemos el valor del input\r\n            const filterObject = {\"type\": \"tag\", \"value\": filterText};\r\n            setFilter(filterObject);\r\n            $(this).val(''); // Limpiamos el input\r\n        }\r\n    });\r\n\r\n    $(document).on(\"keydown\", \"#autorFilters\", async function() {\r\n        const filterText = $(this).val(); // Obtenemos el valor del input\r\n        const request = {\r\n            methodname: 'core_enrol_get_potential_users',\r\n            args: {courseid: 1, enrolid: 1, page: 0, perpage: 10, search: filterText, searchanywhere: true}\r\n        };\r\n        const response = await Ajax.call([request])[0];\r\n\r\n        if (response.length === 0) {\r\n            $(\"#suggestionsAutors\").empty();\r\n        } else {\r\n            const authorsSuggestions = await Templates.renderForPromise('local_digitalta/_common/listAutors', {users: response});\r\n            Templates.replaceNodeContents(\"#suggestionsAutors\", authorsSuggestions.html, authorsSuggestions.js);\r\n        }\r\n    });\r\n\r\n    $(\"#suggestionsTags\").on(\"click\", \".tag-item\", function() {\r\n        const filterText = {type: \"tag\", value: $(this).attr('attr-name')};\r\n        setFilter(filterText);\r\n        $(\"#inlineFormInputGroup\").val(\"\");\r\n    });\r\n\r\n    $(\"#suggestionsAutors\").on(\"click\", \".autor-item\", function() {\r\n        const filterText = {type: \"author\", value: {id: $(this).attr('attr-id-user'), name: $(this).attr('attr-name')}};\r\n        setFilter(filterText);\r\n        $(\"#autorFilters\").val(\"\");\r\n    });\r\n\r\n\r\n    $(\"#filters-menu\").click(function() {\r\n        if ($(\".tagsInputFilter\").is(\":focus\")) {\r\n            $(\"#suggestionsAutors\").hide();\r\n            $(\"#suggestionsTags\").show();\r\n        } else if ($(\"#autorFilters\").is(\":focus\")) {\r\n            $(\"#suggestionsTags\").hide();\r\n            $(\"#suggestionsAutors\").show();\r\n        } else {\r\n            $(\"#suggestionsTags\").hide();\r\n            $(\"#suggestionsAutors\").hide();\r\n        }\r\n    });\r\n\r\n    $(document).on(\"click\", \"#removeFilter\", function() {\r\n        const filterText = $(this).attr('attr-filter');\r\n        const filterType = $(this).attr('attr-type');\r\n        const filterObject = {\"type\": filterType, \"value\": filterText};\r\n        removeFilter(filterObject);\r\n    });\r\n};\r\n\r\nconst getExperiences = async() => {\r\n    // Remapeamos la data por el caso especial de autores\r\n    const mappedFilters = filters.map((filter) => {\r\n        if (filter.type === 'author' || filter.type === 'theme') {\r\n            return {type: filter.type, value: filter.value.id};\r\n        }\r\n        return filter;\r\n    });\r\n\r\n    const request = {\r\n        methodname: 'local_digitalta_experiences_get_by_pagination',\r\n        args: {\r\n            'pagenumber': selectedPage,\r\n            'filters': JSON.stringify(mappedFilters)\r\n        }\r\n    };\r\n    const response = await Ajax.call([request])[0];\r\n\r\n    if (response.data.length === 0) {\r\n        Templates.renderForPromise('local_digitalta/_common/empty-view', response).then(({html, js}) => {\r\n            Templates.replaceNodeContents(\"#list-experience-body\", html, js);\r\n        }).catch((error) => displayException(error));\r\n        $(\".digitalta.pagination\").hide();\r\n    } else {\r\n        let obj = {\"experiences\": response};\r\n        let paginationArray = generatePagination(response.pages, selectedPage);\r\n        const experienceList = await Templates.renderForPromise('local_digitalta/experiences/dashboard/experience-list',\r\n            obj\r\n        );\r\n        pages = response.pages;\r\n        const pagination = await Templates.renderForPromise('local_digitalta/_common/pagination', {\"pages\": paginationArray});\r\n        Templates.replaceNodeContents(\"#list-experience-body\", experienceList.html, experienceList.js);\r\n        Templates.replaceNodeContents(\"#digital-pagination\", pagination.html, pagination.js);\r\n        $(\".digitalta.pagination\").show();\r\n    }\r\n};\r\n\r\nconst generatePagination = (totalPages, selectedPage) => {\r\n    let pagination = [];\r\n    for (let i = 0; i < totalPages; i++) {\r\n        let page = {\r\n            page: i + 1,\r\n            selected: i + 1 === selectedPage\r\n        };\r\n        pagination.push(page);\r\n    }\r\n    return pagination;\r\n};\r\n\r\nconst getAndRenderFilters = async() => {\r\n    const themesRequest = {\r\n        methodname: 'local_digitalta_themes_get',\r\n        args: {}\r\n    };\r\n    const tagsRequest = {methodname: 'local_digitalta_tags_get', args: {}};\r\n    const languajesRequest = {methodname: 'local_digitalta_experiences_get_used_langs', args: {}};\r\n    const themesResponse = await Ajax.call([themesRequest])[0];\r\n    const tagsResponse = await Ajax.call([tagsRequest])[0];\r\n    const languajesResponse = await Ajax.call([languajesRequest])[0];\r\n\r\n    // eslint-disable-next-line max-len\r\n    const templateFilterThemes = await Templates.renderForPromise('local_digitalta/_common/filterTheme', {\"themes\": themesResponse});\r\n    // eslint-disable-next-line max-len\r\n    const templateFilterLanguajes = await Templates.renderForPromise('local_digitalta/_common/filterLanguajes', {\"languajes\": languajesResponse});\r\n    Templates.replaceNodeContents(\"#filterThemeSelect\", templateFilterThemes.html, templateFilterThemes.js);\r\n    Templates.replaceNodeContents(\"#filterLanguajeSelect\", templateFilterLanguajes.html, templateFilterLanguajes.js);\r\n\r\n    const availableTags = tagsResponse.map(function(tag) {\r\n        return tag.name;\r\n    });\r\n\r\n    // Evento de entrada en el campo de texto\r\n    $('#inlineFormInputGroup').on('input', async function() {\r\n        var input = $(this).val().toLowerCase();\r\n        var suggestions = availableTags.filter(function(tag) {\r\n            return tag.toLowerCase().startsWith(input);\r\n        });\r\n\r\n        const templateFilterTags = await Templates.renderForPromise('local_digitalta/_common/listTags', {tags: suggestions});\r\n        Templates.replaceNodeContents(\"#suggestionsTags\", templateFilterTags.html, templateFilterTags.js);\r\n    });\r\n};\r\n\r\nconst setFilter = (filterObject) => {\r\n    filters.push(filterObject);\r\n    selectedPage = 1;\r\n    renderFilters();\r\n};\r\n\r\nconst removeFilter = (filterObject) => {\r\n    const index = filters.findIndex((filter) => {\r\n        if (filter.type === 'author' || filter.type === 'theme') {\r\n            return filter.type === filterObject.type && filter.value.name === filterObject.value;\r\n        } else {\r\n            return filter.type === filterObject.type && filter.value === filterObject.value;\r\n        }\r\n    });\r\n\r\n    if (index > -1) {\r\n        if (filterObject.type === 'theme') {\r\n            let themeSelect = $(\"#filterThemes\");\r\n            let option = $('option[value=\"' + filters[index].value.id + '\"].disabled', themeSelect);\r\n            option.removeClass('disabled');\r\n            option.addClass('enable');\r\n            $(\"#filterThemes option:first\").prop(\"selected\", true);\r\n            $(option).prop('disabled', false);\r\n        } else if (filterObject.type === 'languaje') {\r\n            let langSelect = $(\".filterLanguajeSelect\");\r\n            let option = $('option[value=\"' + filterObject.value + '\"].disabled', langSelect);\r\n            option.removeClass('disabled');\r\n            option.addClass('enable');\r\n            $(\".filterLanguajeSelect option:first\").prop(\"selected\", true);\r\n            $(option).prop('disabled', false);\r\n        }\r\n        filters.splice(index, 1);\r\n        selectedPage = 1;\r\n        renderFilters();\r\n    }\r\n};\r\n\r\nconst renderFilters = () => {\r\n    getExperiences();\r\n    const filtersMap = filters.map((filter) => {\r\n        if (filter.type === 'author' || filter.type === 'theme') {\r\n            return {type: filter.type, value: filter.value.name};\r\n        } else {\r\n            return {type: filter.type, value: filter.value};\r\n        }\r\n    });\r\n    Templates.renderForPromise('local_digitalta/_common/filterList', {filters: filtersMap}).then(({html, js}) => {\r\n        Templates.replaceNodeContents(\"#filtersList\", html, js);\r\n    }).catch((error) => displayException(error));\r\n};"],"names":["pages","filters","selectedPage","getAndRenderFilters","getExperiences","on","e","stopPropagation","document","clickedPage","this","attr","parseInt","state","posibleNextPage","posiblePreviousPage","selectedValue","val","selectedText","text","length","element","addClass","removeClass","setFilter","id","name","prop","event","key","keyCode","filterText","async","request","methodname","args","courseid","enrolid","page","perpage","search","searchanywhere","response","Ajax","call","empty","authorsSuggestions","Templates","renderForPromise","users","replaceNodeContents","html","js","type","value","click","is","hide","show","filterType","removeFilter","mappedFilters","map","filter","JSON","stringify","data","then","_ref","catch","error","obj","paginationArray","generatePagination","experienceList","pagination","totalPages","i","selected","push","themesResponse","tagsResponse","languajesResponse","templateFilterThemes","templateFilterLanguajes","availableTags","tag","input","toLowerCase","suggestions","startsWith","templateFilterTags","tags","filterObject","renderFilters","index","findIndex","themeSelect","option","langSelect","splice","filtersMap","_ref2"],"mappings":"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"}